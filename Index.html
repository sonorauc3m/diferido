<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Diferido ¬∑ Sonora UC3M</title>

<style>
:root{
  --sonora-red:#be1622;
  --dark:#050307;
  --card:#111;
  --text:#fff;
  --muted:#bbbbbb;
}

*{margin:0;padding:0;box-sizing:border-box;}
html,body{background:black;color:white;font-family:"Helvetica Now Display",Helvetica,Arial,sans-serif;}

/* CABECERA */
header{
  padding:22px;
  text-align:center;
}
.logo{
  width:240px;
  filter:drop-shadow(0 10px 30px rgba(0,0,0,.6));
}

/* TITULO */
h1{
  text-align:center;
  font-size:1.6rem;
  margin-top:10px;
  font-weight:800;
}

/* CAT√ÅLOGO */
.list{
  margin-top:28px;
  padding:0 18px;
  display:flex;
  flex-direction:column;
  gap:35px;
}

/* CADA PROGRAMA */
.program{
}
.program h2{
  font-size:1.1rem;
  margin-bottom:10px;
  font-weight:700;
  letter-spacing:.5px;
}

/* CARRUSEL */
.row{
  display:flex;
  overflow-x:auto;
  gap:16px;
  padding-bottom:6px;
  scroll-snap-type:x mandatory;
}
.row::-webkit-scrollbar{height:6px;}
.row::-webkit-scrollbar-thumb{background:#444;border-radius:10px;}
.row::-webkit-scrollbar-track{background:transparent;}

.card{
  background:linear-gradient(150deg,rgba(255,255,255,.08),rgba(0,0,0,.6));
  width:240px;
  flex-shrink:0;
  border-radius:18px;
  padding:16px;
  scroll-snap-align:start;
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 12px 32px rgba(0,0,0,.65);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

/* NOMBRE */
.card-title{
  font-size:1rem;
  font-weight:700;
  margin-bottom:8px;
}

/* DESC */
.card-desc{
  font-size:.82rem;
  color:var(--muted);
  line-height:1.35;
  margin-bottom:10px;
}

/* PLATAFORMAS */
.links{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:auto;
}
.btn{
  padding:6px 12px;
  border-radius:999px;
  font-size:.75rem;
  background:white;
  color:var(--sonora-red);
  font-weight:700;
  text-decoration:none;
}
.btn:hover{opacity:.85;}

/* PLAYER POPUP */
.player-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99;
}
.player-box{
  background:#121212;
  width:92%;
  max-width:440px;
  padding:22px;
  border-radius:18px;
  text-align:center;
  border:1px solid rgba(255,255,255,.14);
}
.player-title{
  font-size:1.05rem;
  font-weight:800;
  margin-bottom:12px;
}
.player-audio{
  width:100%;
  margin-top:10px;
}
.close{
  margin-top:18px;
  font-size:.85rem;
  opacity:.7;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <img src="sonora_2.1_blanco.png" class="logo">
  <h1>Programas en diferido</h1>
</header>

<!-- CONTENEDOR -->
<div class="list" id="list">Cargando programas‚Ä¶</div>

<!-- üîä PLAYER EMERGENTE -->
<div class="player-bg" id="player">
  <div class="player-box">
    <div class="player-title" id="p-title">T√≠tulo</div>
    <audio id="p-audio" class="player-audio" controls autoplay></audio>
    <div class="close" onclick="document.getElementById('player').style.display='none'">
      Cerrar ‚úï
    </div>
  </div>
</div>


<script>
/* GOOGLE SHEETS */
const SHEET="OnDemand";
const ID="1g9f3Ue9GtdaTbpxp3DCXncrNPhjnHPk0m9QTXdfSAxM";

function gviz(){
  return `https://docs.google.com/spreadsheets/d/${ID}/gviz/tq?tqx=out:json&sheet=${SHEET}`;
}

async function load(){
  const T=await fetch(gviz()).then(r=>r.text());
  const J=JSON.parse(T.substr(47).slice(0,-2));
  const rows=J.table.rows.slice(1);

  const div=document.getElementById("list");
  div.innerHTML="";

  const programGroups={};

  rows.forEach(r=>{
    const [name,desc,sp,iv,yt]=r.c.map(c=>c?.v||"");
    if(!name)return;
    if(!programGroups[name])programGroups[name]=[];
    programGroups[name].push({desc,sp,iv,yt});
  });

  Object.keys(programGroups).forEach(program=>{
    const box=document.createElement("div");
    box.className="program";
    box.innerHTML=`<h2>${program}</h2>`;

    const row=document.createElement("div");
    row.className="row";

    programGroups[program].forEach(ep=>{
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=
        `<div class="card-title">${program}</div>
         <div class="card-desc">${ep.desc||"Sin descripci√≥n"}</div>
         <div class="links"></div>`;

      const L=card.querySelector(".links");
      if(ep.sp) btn(L,"Spotify",ep.sp);
      if(ep.iv) btn(L,"iVoox",ep.iv);
      if(ep.yt) btn(L,"YouTube",ep.yt);

      row.appendChild(card);
    })

    box.appendChild(row);
    div.appendChild(box);
  })
}

function btn(container,label,url){
  const a=document.createElement("a");
  a.className="btn";
  a.href=url;
  a.target="_blank";
  a.textContent=label;
  container.appendChild(a);
}

load();
</script>
</body>
</html>
